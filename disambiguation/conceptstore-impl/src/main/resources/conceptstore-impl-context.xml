<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xmlns:context="http://www.springframework.org/schema/context" xmlns:tx="http://www.springframework.org/schema/tx"
	xmlns:p="http://www.springframework.org/schema/p" xmlns:aop="http://www.springframework.org/schema/aop" xmlns:mvc="http://www.springframework.org/schema/mvc"
	xsi:schemaLocation="http://www.springframework.org/schema/beans  http://www.springframework.org/schema/beans/spring-beans-3.0.xsd  http://www.springframework.org/schema/context  http://www.springframework.org/schema/context/spring-context-3.0.xsd  http://www.springframework.org/schema/tx  http://www.springframework.org/schema/tx/spring-tx-3.0.xsd  http://www.springframework.org/schema/aop  http://www.springframework.org/schema/aop/spring-aop-3.0.xsd http://www.springframework.org/schema/mvc http://www.springframework.org/schema/mvc/spring-mvc-3.0.xsd"
	default-init-method="init" default-destroy-method="destroy">

	<import resource="classpath:conceptstore-utils-context.xml" />

	<!-- GRAPH DATABASE AND TRANSACTION CONFIGURATION -->

	<tx:annotation-driven transaction-manager="transactionManager" />
	<alias name="neo4jTransactionManager" alias="transactionManager" />

	<bean id="neo4jTransactionManagerService" class="org.neo4j.kernel.impl.transaction.SpringTransactionManager">
		<constructor-arg ref="graphDb" />
	</bean>
	<bean id="neo4jUserTransactionService" class="org.neo4j.kernel.impl.transaction.UserTransactionImpl">
		<constructor-arg ref="graphDb" />
	</bean>

	<bean id="neo4jTransactionManager" class="org.springframework.transaction.jta.JtaTransactionManager">
		<property name="transactionManager" ref="neo4jTransactionManagerService" />
		<property name="userTransaction" ref="neo4jUserTransactionService" />
	</bean>

	<bean id="graphDb" factory-bean="graphStorageTemplate" factory-method="getGraphDatabaseService" />


	<!-- SERVICES -->

	<bean id="graphStorageTemplate" class="org.biosemantics.disambiguation.service.local.impl.GraphStorageTemplateImpl">
		<constructor-arg value="${data.store}" />
		<constructor-arg value="${neo4j.startServer}" />
		<!-- <constructor-arg> -->
		<!-- <map> -->
		<!-- <entry key="neostore.nodestore.db.mapped_memory" value="550M"/> -->
		<!-- <entry key="neostore.relationshipstore.db.mapped_memory" value="500M"/> -->
		<!-- <entry key="neostore.propertystore.db.mapped_memory" value="100M"/> -->
		<!-- <entry key="neostore.propertystore.db.strings.mapped_memory" value="100M"/> -->
		<!-- <entry key="neostore.propertystore.db.arrays.mapped_memory" value="0M"/> -->
		<!-- -->
		<!-- </map> -->
		<!-- </constructor-arg> -->
	</bean>

	<bean id="labelStorageServiceLocal" class="org.biosemantics.disambiguation.service.local.impl.LabelStorageServiceLocalImpl">
		<constructor-arg>
			<ref local="graphStorageTemplate" />
		</constructor-arg>
		<property name="validationUtility" ref="validationUtility"></property>
	</bean>

	<bean id="notationStorageServiceLocal" class="org.biosemantics.disambiguation.service.local.impl.NotationStorageServiceLocalImpl">
		<constructor-arg>
			<ref local="graphStorageTemplate" />
		</constructor-arg>
		<property name="validationUtility" ref="validationUtility"></property>
	</bean>

	<bean id="noteStorageServiceLocal" class="org.biosemantics.disambiguation.service.local.impl.NoteStorageServiceLocalImpl">
		<constructor-arg>
			<ref local="graphStorageTemplate" />
		</constructor-arg>
		<property name="validationUtility" ref="validationUtility"></property>
	</bean>

	<bean id="conceptStorageServiceLocal" class="org.biosemantics.disambiguation.service.local.impl.ConceptStorageServiceLocalImpl">
		<constructor-arg>
			<ref local="graphStorageTemplate" />
		</constructor-arg>
		<property name="uuidGeneratorService" ref="uuidGeneratorService"></property>
		<property name="labelStorageServiceLocal" ref="labelStorageServiceLocal"></property>
		<property name="notationStorageServiceLocal" ref="notationStorageServiceLocal"></property>
		<property name="noteStorageServiceLocal" ref="noteStorageServiceLocal"></property>
		<property name="validationUtility" ref="validationUtility"></property>
	</bean>

	<bean id="conceptRelationshipStorageServiceLocal" class="org.biosemantics.disambiguation.service.local.impl.ConceptRelationshipStorageServiceLocalImpl">
		<constructor-arg>
			<ref local="graphStorageTemplate" />
		</constructor-arg>
		<property name="uuidGeneratorService" ref="uuidGeneratorService"></property>
		<property name="validationUtility" ref="validationUtility"></property>
		<property name="conceptStorageServiceLocal" ref="conceptStorageServiceLocal"></property>
	</bean>

	<bean id="algorithmServiceLocal" class="org.biosemantics.disambiguation.service.local.impl.AlgorithmServiceLocalImpl">
		<property name="conceptStorageServiceLocal" ref="conceptStorageServiceLocal"></property>
	</bean>

</beans>